---
title: "Presidential Approval"
author: "Mark Hand"
date: "11/28/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, message=FALSE, warning=FALSE)
library(readxl)
library(tidyverse)
library(lubridate)
```

## What This Is
This is some initial data exploration on some presidential approval data. 

## Data 
The data we're using comes from Gallup. That's behind a paywall, so we yanked it from [The American Presidency Project](https://www.presidency.ucsb.edu/statistics/data/presidential-job-approval), which shares the data as a rather unworkable Excel sheet, which we then tidied. 

```{r importing approval}
approval <- read_excel("data/presidential_approval/American Presidency Project - Approval Ratings for POTUS.xlsx", 
    col_types = c("text", "date", "date", 
        "numeric", "numeric", "numeric"))
approval %>% 
  mutate(Approving_change = Approving - lead(Approving), Disapproving_change = Disapproving - lead(Disapproving),
         `Unsure/NoData_change` = `Unsure/NoData` - lead(`Unsure/NoData`)) -> approval
```

## Data examination 

### Summary statistics of approval 
Need to figure out how to ignore the changes from one president to another; also want to see variation within an election cycle (starts in March). 

```{r summary statistics, echo=FALSE}
# Overall summary statistics
approval %>% summarize(mean=mean(Approving), sd=sd(Approving), max=max(Approving), min=min(Approving))
# Why does this give per-month statistics? 

# President-specific summary statistics
approval %>% group_by(President) %>% summarize(mean=mean(Approving), sd=sd(Approving), max=max(Approving), min=min(Approving))
# approval %>% split(.$President) %>% map(summary)
```

### Histograms of approval and disapproval
```{r histograms, echo=FALSE}
ggplot(approval, aes(Approving)) + geom_histogram() + theme_minimal()

ggplot(approval, aes(Disapproving)) + geom_histogram() + theme_minimal()

ggplot(approval, aes(`Unsure/NoData`)) + geom_histogram() + theme_minimal()

```

## Summary statistics of change in approval 
```{r change in approval }
# Overall summary statistics
approval %>% summarize(mean=mean(Approving_change), sd=sd(Approving_change), max=max(Approving_change), min=min(Approving_change))
# Why does this give per-month statistics? Let's call it sd=2.5

approval %>% summarize(mean=mean(Disapproving_change), sd=sd(Disapproving_change), max=max(Disapproving_change), min=min(Disapproving_change))
#Change in admins in Janaury is dragging up the sd here. Let's call this sd=2.75

approval %>% summarize(mean=mean(`Unsure/NoData_change`), sd=sd(`Unsure/NoData_change`), max=max(`Unsure/NoData_change`), min=min(`Unsure/NoData_change`))
# Interesting, changes less. Call it sd=1.75 

# President-specific summary statistics
approval %>% group_by(President) %>% summarize(mean=mean(Approving_change,na.rm=T), sd=sd(Approving_change, na.rm=T), max=max(Approving_change, na.rm=T), min=min(Approving_change, na.rm=T))
# Interesting. Less change in Presidential approval over time. 

# President-specific approval AND change statistics for Chet 
approval %>% group_by(President) %>% summarize(
  `# of polls`=n(),
  mean=mean(Approving), 
  sd=sd(Approving), 
  max=max(Approving), 
  min=min(Approving),
  `mean(change)`=mean(Approving_change,na.rm=T), 
  `sd(change)`=sd(Approving_change, na.rm=T), 
  `max(change)`=max(Approving_change, na.rm=T), 
  `min(change)`=min(Approving_change, na.rm=T)) -> forChet 
```

## Histograms of change in approval 
```{r change histograms}
ggplot(approval, aes(Approving_change)) + geom_histogram() + theme_minimal()

ggplot(approval, aes(Disapproving_change)) + geom_histogram() + theme_minimal()

ggplot(approval, aes(`Unsure/NoData_change`)) + geom_histogram() + theme_minimal()
```



## Plots! 
Need to figure out how to fix x-axis in facet wrap. 
```{r approval over time, eval=F}
ggplot(data = approval, aes(x = `Start Date`, y = Approving, group = President, color = President)) +
  geom_line() +
  theme_minimal()

ggplot(approval, aes(x = `Start Date`, y = Approving, group = President, colour = President)) +
    geom_line() +
    facet_wrap(~President) + 
    theme_minimal()

ggplot(data = approval, aes(x = `Start Date`, y = `Unsure/NoData`, group = President, color = President)) +
  geom_line() +
  theme_minimal()
```

## Looking at the data by month
```{r monthly view tidying FAIL, eval=F}

approval %>% 
  mutate(
    month = month(`Start Date`),
    year = year(`Start Date`)) -> monthlyapproval

monthlyapproval %>%
  group_by(year, month) %>%
  mutate(
    Approving_Month = mean(Approving),
    Disapproving_Month = mean(Disapproving),
    `Unsure/NoData_Month` = mean(`Unsure/NoData`)
  ) -> monthlyapproval

# Why are there duplicates here?? 

monthlyapproval %>% 
  select(President, month, year, Approving_Month, Disapproving_Month, `Unsure/NoData_Month`) %>% 
  distinct() -> monthlyapproval

monthlyapproval %>% 
  mutate(Approving_change = Approving_Month - lead(Approving_Month), Disapproving_change = Disapproving_Month - lead(Disapproving_Month),
         `Unsure/NoData_change` = `Unsure/NoData_Month` - lead(`Unsure/NoData_Month`)) -> monthlyapproval



```

```{r monthly view plot FAIL}
ggplot(data = monthlyapproval, aes(x = `Start Date`, y = Approving_Month, color=President)) + geom_line() + facet_wrap( ~ President, ncol = 3, scales = "free_x") + theme_minimal() + labs(title="Presidential Approval", x="", y="Percent Approval")
```

```{r change in monthly approval}
# Overall summary statistics
monthlyapproval %>% summarize(mean=mean(Approving_change), sd=sd(Approving_change), max=max(Approving_change), min=min(Approving_change))
# Why does this give per-month statistics? Let's call it sd=2.5

approval %>% summarize(mean=mean(Disapproving_change), sd=sd(Disapproving_change), max=max(Disapproving_change), min=min(Disapproving_change))
#Change in admins in Janaury is dragging up the sd here. Let's call this sd=2.75

approval %>% summarize(mean=mean(`Unsure/NoData_change`), sd=sd(`Unsure/NoData_change`), max=max(`Unsure/NoData_change`), min=min(`Unsure/NoData_change`))
# Interesting, changes less. Call it sd=1.75 

# President-specific summary statistics
approval %>% group_by(President) %>% summarize(mean=mean(Approving_change,na.rm=T), sd=sd(Approving_change, na.rm=T), max=max(Approving_change, na.rm=T), min=min(Approving_change, na.rm=T))
# Interesting. Less change in Presidential approval over time. 


## Identifying Shocks 
```{r identifying shocks, echo=F}
# Overall, identify any jumps or drops in approval over 2.5, and over 5.

approval %>% 
  mutate(shock1sd = ifelse(abs(Approving_change) > 2.5, 1, 0),
         shock2sd = ifelse(abs(Approving_change) > 5, 1, 0),
         shock3sd = ifelse(abs(Approving_change) > 7.5, 1, 0)) -> approval

# I don't know the right way to see how many shocks there are, but summary() tells me there are 3985 data points and that 17.27% involve changes over 2.5 points, 4.367% of them involve shocks over 5 points, and that 1.707% of them involve shocks over 7 points. 

# Then any jumps or drops over the sd(x1) and sd(x2) of that specific president, to account for change over time in stickiness of ratings. 
# Then do the same for disapproval and unsure/no data. 
```

## Identifying Monthly Shocks 
```{r identifying shocks, eval=F}
# Overall, identify any jumps or drops in approval over 2.5, and over 5.

monthlyapproval %>% 
  mutate(shock1sd = ifelse(abs(Approving_change) > 2.5, 1, 0),
         shock2sd = ifelse(abs(Approving_change) > 5, 1, 0),
         shock3sd = ifelse(abs(Approving_change) > 7.5, 1, 0)) -> monthlyapproval

# I don't know the right way to see how many shocks there are, but summary() tells me there are 3985 data points and that 17.27% involve changes over 2.5 points, 4.367% of them involve shocks over 5 points, and that 1.707% of them involve shocks over 7 points. 

# Then any jumps or drops over the sd(x1) and sd(x2) of that specific president, to account for change over time in stickiness of ratings. 
# Then do the same for disapproval and unsure/no data. 
```
Next questions

* What counts as a "major" change? 
* What periods should we be looking at? How do we construct months? 
* Peter: What is strategy? Marketing; FEC data on expenditures?  
* Peter: Is there precedent for what counts as a shock? 
* Peter: Where to pull FEC data from, most effectively? 
* How to talk about change in donation patterns? 